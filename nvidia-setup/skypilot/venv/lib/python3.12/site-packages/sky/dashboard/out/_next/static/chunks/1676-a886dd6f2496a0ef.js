"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1676],{23266:function(e,t,a){a.d(t,{GH:function(){return h},QL:function(){return w},Sl:function(){return _},getClusters:function(){return i},r7:function(){return g},uR:function(){return d}});var r=a(67294),s=a(15821),n=a(47145),l=a(93225),o=a(6378),c=a(10410);let u={UP:"RUNNING",STOPPED:"STOPPED",INIT:"LAUNCHING",PENDING:"PENDING",null:"TERMINATED"};async function i(){let{clusterNames:e=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=await n.x.fetch("/status",{cluster_names:e,all_users:!0,include_credentials:!1,include_handle:!1,summary_response:null==e}),a=t.map(e=>{let t="";t=e.zone?e.zone:e.region,"SSH"===e.cloud&&(null==t?void 0:t.startsWith("ssh-"))&&(t=t.substring(4));let a=t;return t&&t.length>25&&(t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;if(!e||e.length<=t)return e;if(t<=3)return"...";let a=Math.floor((t-3)/2),r=a+(t-3)%2;return 0===a?e.substring(0,r)+"...":e.substring(0,r)+"..."+e.substring(e.length-a)}(t,25)),{status:u[e.status],cluster:e.name,user:e.user_name,user_hash:e.user_hash,cluster_hash:e.cluster_hash,cloud:e.cloud,region:e.region,infra:t?e.cloud+" ("+t+")":e.cloud,full_infra:a?"".concat(e.cloud," (").concat(a,")"):e.cloud,cpus:e.cpus,mem:e.memory,gpus:e.accelerators,resources_str:e.resources_str,resources_str_full:e.resources_str_full,time:new Date(1e3*e.launched_at),num_nodes:e.nodes,workspace:e.workspace,autostop:e.autostop,last_event:e.last_event,to_down:e.to_down,cluster_name_on_cloud:e.cluster_name_on_cloud,labels:e.labels||{},jobs:[],command:e.last_creation_command||e.last_use,task_yaml:e.last_creation_yaml||"{}",events:[{time:new Date(1e3*e.launched_at),event:"Cluster created."}]}});return await (0,c.M)(a,"clusters",{dashboardCache:o.ZP,rawData:t})}catch(e){throw console.error("Error fetching clusters:",e),e}}async function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{let a={days:t,dashboard_summary_response:!0};e&&(a.cluster_hashes=[e]);let r=await n.x.fetch("/cost_report",a),s=r.map(e=>{let t="Unknown";e.cloud?t=e.cloud:e.resources&&e.resources.cloud&&(t=e.resources.cloud);let a=e.user_name||"-";return{status:e.status?u[e.status]:"TERMINATED",cluster:e.name,user:a,user_hash:e.user_hash,cluster_hash:e.cluster_hash,cloud:t,region:"",infra:t,full_infra:t,resources_str:e.resources_str,resources_str_full:e.resources_str_full,time:e.launched_at?new Date(1e3*e.launched_at):null,num_nodes:e.num_nodes||1,duration:e.duration,total_cost:e.total_cost,workspace:e.workspace||"default",autostop:-1,last_event:e.last_event,to_down:!1,cluster_name_on_cloud:null,usage_intervals:e.usage_intervals,command:e.last_creation_command||"",task_yaml:e.last_creation_yaml||"{}",events:[{time:e.launched_at?new Date(1e3*e.launched_at):new Date,event:"Cluster created."}]}});return await (0,c.M)(s,"clusters",{dashboardCache:o.ZP,rawData:r})}catch(e){throw console.error("Error fetching cluster history:",e),e}}async function _(e){let{clusterName:t,jobId:a,onNewLog:r,workspace:l,signal:o}=e;try{await n.x.stream("/logs",{follow:!1,cluster_name:t,job_id:a,tail:5e3,override_skypilot_config:{active_workspace:l||"default"}},r,{signal:o})}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Error in streamClusterJobLogs:",e),(0,s.C)("Error in streamClusterJobLogs: ".concat(e.message),"error")}}async function h(e){let{clusterName:t,jobIds:a=null,workspace:r}=e;try{let e=await n.x.fetch("/download_logs",{cluster_name:t,job_ids:a?a.map(String):null,override_skypilot_config:{active_workspace:r||"default"}}),o=Object.values(e||{});if(!o.length){(0,s.C)("No logs found to download.","warning");return}let c=window.location.origin,u="".concat(c).concat(l.f4,"/download"),i=await fetch("".concat(u,"?relative=items"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folder_paths:o})});if(!i.ok){let e=await i.text();throw Error("Download failed: ".concat(i.status," ").concat(e))}let d=await i.blob(),_=window.URL.createObjectURL(d),h=document.createElement("a"),f=new Date().toISOString().replace(/[:.]/g,"-"),w=a&&1===a.length?"job-".concat(a[0]):"jobs";h.href=_,h.download="".concat(t,"-").concat(w,"-logs-").concat(f,".zip"),document.body.appendChild(h),h.click(),h.remove(),window.URL.revokeObjectURL(_)}catch(e){console.error("Error downloading logs:",e),(0,s.C)("Error downloading logs: ".concat(e.message),"error")}}async function f(e){let{clusterName:t,workspace:a}=e;try{return(await n.x.fetch("/queue",{cluster_name:t,all_users:!0,override_skypilot_config:{active_workspace:a}})).map(e=>{var r;let s=e.end_at?e.end_at:Date.now()/1e3,n=0,l=0;return e.submitted_at&&(n=s-e.submitted_at),e.start_at&&(l=s-e.start_at),{id:e.job_id,status:e.status,job:e.job_name,user:e.username,user_hash:e.user_hash,gpus:e.accelerators||{},submitted_at:e.submitted_at?new Date(1e3*e.submitted_at):null,resources:e.resources,cluster:t,total_duration:n,job_duration:l,infra:"",logs:"",workspace:a||"default",git_commit:(null===(r=e.metadata)||void 0===r?void 0:r.git_commit)||"-"}})}catch(e){throw console.error("Error fetching cluster jobs:",e),e}}function w(e){let{cluster:t,job:a=null}=e,[s,n]=(0,r.useState)(null),[l,c]=(0,r.useState)(null),[u,d]=(0,r.useState)(!0),[_,h]=(0,r.useState)(!0),w=(0,r.useCallback)(async()=>{if(t)try{d(!0);let e=await o.ZP.get(i,[{clusterNames:[t]}]);if(e.length>0)return n(e[0]),e[0];return console.error("No cluster data found for cluster:",t),null}catch(e){console.error("Error fetching cluster data:",e)}finally{d(!1)}return null},[t]),g=(0,r.useCallback)(async e=>{if(t)try{h(!0);let a=await o.ZP.get(f,[{clusterName:t,workspace:e||"default"}]);c(a)}catch(e){console.error("Error fetching cluster job data:",e)}finally{h(!1)}},[t]),m=(0,r.useCallback)(async()=>{o.ZP.invalidate(i,[{clusterNames:[t]}]);let e=await w();e&&(o.ZP.invalidate(f,[{clusterName:t,workspace:e.workspace||"default"}]),await g(e.workspace))},[w,g,t]),p=(0,r.useCallback)(async()=>{s&&(o.ZP.invalidate(f,[{clusterName:t,workspace:s.workspace||"default"}]),await g(s.workspace))},[g,s,t]);return(0,r.useEffect)(()=>{(async()=>{let e=await w();e&&g(e.workspace)})()},[t,a,w,g]),{clusterData:s,clusterJobData:l,loading:u,clusterDetailsLoading:u,clusterJobsLoading:_,refreshData:m,refreshClusterJobsOnly:p}}function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{showHistory:t=!1,historyDays:a=1,refreshInterval:s=null,sortConfig:n={key:null,direction:"ascending"},filters:l=[]}=e,c=n.key||"launched_at",u=n.key&&"ascending"===n.direction?"asc":"desc",_=JSON.stringify(l),[h,f]=(0,r.useState)([]),[w,g]=(0,r.useState)([]),[m,p]=(0,r.useState)(!0),[y,b]=(0,r.useState)(1),[v,k]=(0,r.useState)(10),[E,C]=(0,r.useState)(0),[S,P]=(0,r.useState)(1),[D,N]=(0,r.useState)(!1),[j,L]=(0,r.useState)(!1),[I,Z]=(0,r.useState)(null),[U,O]=(0,r.useState)(!1);(0,r.useEffect)(()=>{b(1)},[_]);let T=(0,r.useCallback)(async()=>{console.log("[useClusterData] Using server-side pagination");let e=window.__skyPaginationFetch,r=await o.ZP.get(e,[{page:y,limit:v,showHistory:t,historyDays:a,sortBy:c,sortOrder:u,filters:l}]),s=r.total||0,n=r.totalPages||r.total_pages||1,i=r.hasNext||r.has_next||!1,d=r.hasPrev||r.has_prev||!1,_=r.items||r.data||[];f(_),g(_),C(s),P(n),N(i),L(d),O(!0),i&&o.ZP.get(e,[{page:y+1,limit:v,showHistory:t,historyDays:a,sortBy:c,sortOrder:u,filters:l}],{ttl:3e4}).then(()=>console.log("[useClusterData] Prefetched page",y+1)).catch(e=>console.warn("[useClusterData] Prefetch failed:",e))},[y,v,t,a,c,u,l]),x=(0,r.useCallback)(async()=>{let e;console.log("[useClusterData] Using client-side pagination");let r=await o.ZP.get(i);if(t){let t=[];try{t=await o.ZP.get(d,[null,a])}catch(e){console.error("Error fetching cluster history:",e)}let s=r.map(e=>({...e,isHistorical:!1})),n=t.map(e=>({...e,isHistorical:!0}));e=[...s],n.forEach(t=>{r.some(e=>e.cluster_hash===t.cluster_hash)||e.push(t)})}else e=r.map(e=>({...e,isHistorical:!1}));let s=e.length,n=Math.ceil(s/v)||1,l=(y-1)*v;f(e.slice(l,l+v)),g(e),C(s),P(n),N(y<n),L(y>1),O(!1)},[t,a,y,v]),R=(0,r.useCallback)(async()=>{p(!0),Z(null);try{"function"==typeof window.__skyPaginationFetch?await T():await x()}catch(e){console.error("[useClusterData] Error fetching clusters:",e),Z(e),f([]),g([])}p(!1)},[T,x]);(0,r.useEffect)(()=>{R()},[R]),(0,r.useEffect)(()=>{if(!s)return;let e=setInterval(()=>{"visible"===document.visibilityState&&R()},s);return()=>clearInterval(e)},[s,R]);let H=(0,r.useCallback)(e=>{k(e),b(1)},[]);return{data:h,allData:w,total:E,page:y,limit:v,totalPages:S,hasNext:D,hasPrev:j,setPage:b,setLimit:H,loading:m,error:I,refresh:R,isServerPagination:U}}},23001:function(e,t,a){a.d(t,{X:function(){return s}});var r=a(67294);function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:768,[t,a]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let t=()=>{a(window.innerWidth<e)};return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e]),t}}}]);